var token="[YOUR_TOKEN]",env="[PROJECT MODE][production][development]",copiesLang="CopiesLangCookie",fetchLimits=30,previewLimits=1e3,imageSizeLimits=2e7,minDeviceWidth=391,previewTimeout=2500,refreshTimeout=1e5,uploadTimeout=12e4,panelConfirmTimeout=15e3,saveAndRefreshTimeout=5e3,maxLastCreated=7776e3,isValid=!1,isSignin=!1,isFetching=!1,isSearching=!1,isUploading=!1,isPaused=!1,currentUsername="",lastCreated=0,invalidCreated=0,lastKeyword="",lastLeftScroll=0,previewCopy,removeCopy,saveCopy,clickToRefresh,clickToAdd,clickToEndAdd,clickToSearch,clickToEndSearch,clickToShowStatus,clickToLoadMore,now=function(){var e=Cookies.get(copiesLang)
return"kr"==e?e="ko":"jp"==e&&(e="ja"),moment.locale(e),moment().unix()},keyboardShortcuts=function(){document.onkeydown=function(e){if(isValid&&isSignin&&!isFetching&&!isSearching&&!isUploading){var i=e.which||e.keyCode,a=e.target.tagName.toLowerCase()
return null!=i&&"body"==a?(82==i&&clickToRefresh(),78==i&&clickToAdd(),70==i&&clickToSearch(),!0):void 0}}},availability=function(){var e=window.innerWidth>0?window.innerWidth:screen.width
e<minDeviceWidth&&isSignin?$("#copies-logo").fadeOut():$("#copies-logo").fadeIn(),delete e},exists=function(e){return 0!=$("#"+e).length},contentOn=function(e){return e.length.toString()+' <span lang="us" class="uk-text-muted">characters</span>'},sizeOn=function(e){return filesize(e,{base:10})},contentFilter=function(e){e=$("<div>").text(e).html()
var i=/(https?:\/\/[^\s]+)/g,a=e
try{a=e.replace(i,function(e){return'<a target="_blank" href="'+e+'">'+e+"</a>"})}catch(e){}return[e,a]},contentPreview=function(e){return e.length>previewLimits?e.substring(0,previewLimits):e},dataURItoBlob=function(e){var i
i=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1])
for(var a=e.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(i.length),t=0;t<i.length;t++)n[t]=i.charCodeAt(t)
return new Blob([n],{type:a})},imageErrorPlaceholder=function(e){return e.src="/static/img/placeholder.png",e.onerror="",!0},showLoadingPanel=function(){$("#copies-load-more").hide(),$("#loading-wrapper").show()},hideLoadingPanel=function(){if($("#loading-wrapper").hide(),$("#copies-load-more").hide(),isValid)try{"none"!=$("#copies").find("tbody").css("display")&&$("#copies-load-more").show()}catch(e){}},showWelcome=function(){$("#copies-action").fadeOut(),$("#welcome-wrapper").fadeIn(),$("#copies-load-more").fadeOut()},hideWelcome=function(){$("#welcome-wrapper").fadeOut(),$("#copies-action").fadeIn(),$("#copies").find("tbody").fadeIn()},cleanupCopies=function(){$("#copies").find("tbody").fadeOut().empty()},removeCopies=function(){$("#copies").find("tbody").fadeOut().empty().fadeIn()},clipboard=null,appendCopies=function(e){var i=$("#copies").find("tbody")
if(i){for(var a=[],n=0,t=0;t<e.length;t++){var o=e[t].fields
if(o){var r=o.md5.value,s=o.created.value,l=contentFilter(o.content.value),c=l[1],d=l[0],u=o.img.value,p="",h="",f=0
if(r&&s&&c&&u&&!exists(r)&&!exists(s.toString())){var m=parseInt(s),g='<tr id="'+r+'"><td id="'+s.toString()+'" class="uk-border-rounded">',v="</td></tr>",w=o.content.value.length,k=moment(1e3*m).fromNow(),y=contentOn(d),S='<article class="uk-comment">'
if(S+='<header class="uk-comment-header">',"1"===u){if(!(h=o.r_img.value.downloadURL.replace("${f}",c)))continue
try{p=o.s_img.value.downloadURL.replace("${f}",c)}catch(e){p=h}f=o.r_img.value.size,(p||h||f)&&(S+='<img class="uk-comment-avatar" src="',S+=p,S+='" alt="',S+=c,S+='" ',S+='width="32"',S+=' onerror="imageErrorPlaceholder(this);"',S+=" />",y=sizeOn(f))}S+='<h4 class="uk-comment-title">'
var b="modal-"+r,C=!1
w>previewLimits?(S+=contentPreview(c),S+=' <a href="#'+b+'" data-uk-modal="{center:true}">&nbsp;<i class="uk-icon-ellipsis-h"></i></a>',S+='<div id="'+b+'" class="uk-modal">',S+='<div class="uk-modal-dialog">',S+='<a class="uk-modal-close uk-close"></a>',S+='<div class="uk-modal-header uk-text-muted">',S+=k,S+=", ",S+=y,S+="</div>",S+='<div class="uk-overflow-container">',S+=c,S+="</div>",S+="</div>",S+="</div>",C='<a class="uk-button-link" href="#'+b+'" data-uk-modal="{center:true}"><i class="uk-icon-newspaper-o"></i>&nbsp;<span lang="us"">Preview</span></a>'):(S+='<span id="copies-action-',S+=r,S+='">',S+=c,S+="</span>"),S+="</h4>",S+='<ul class="uk-comment-meta uk-subnav uk-subnav-line">',S+="<li>",S+=k,S+="</li>",S+="<li>",S+=y,S+="</li>","1"===u?(S+="<li>",S+='<a class="uk-button-link" onclick="previewCopy(\'',S+=h,S+='\');"><i class="uk-icon-search-plus"></i>&nbsp;<span lang="us"">Preview</span></a>',S+="</li>"):C?(S+="<li>",S+=C,S+="</li>"):(S+="<li>",S+='<a class="uk-button-link copies-action" data-clipboard-target="#copies-action-',S+=r,S+='"><i class="uk-icon-copy"></i>&nbsp;<span lang="us"">Copy</span>',S+="</a>",S+="</li>"),S+="<li>",S+='<a class="uk-button-link" onclick="removeCopy(\'',S+=r,S+='\');"><i class="uk-icon-remove"></i>&nbsp;<span lang="us"">Delete</span></a>',S+="</li>",S+="</ul>",S+="</header>",S+="</article>",a.push({date:m,row:g+S+v}),delete g}}}$("#copies tr").each(function(e,i){var a=$(i).find("td"),t=$(a).attr("id")
t=parseInt(t),(0==n||t>=n)&&(n=t),delete a})
for(var T=0;T<a.length;T+=1){var U=a[T]
U.date>=n?$(U.row).hide().prependTo(i):$(U.row).hide().appendTo(i),delete U}i.find("tr").sort(function(e,i){var a=parseInt($(e).find("td").attr("id")),n=parseInt($(i).find("td").attr("id"))
return a>n?-1:a<n?1:0}).appendTo(i).fadeIn(),clipboard&&clipboard.destroy(),clipboard=new Clipboard(".copies-action"),clipboard.on("success",function(e){e.clearSelection(),UIkit.notify("<i class='uk-icon-check'></i>&nbsp;&nbsp;<span lang='us'>Content copied!</span>",{timeout:1e3,pos:"bottom-center"})}),clipboard.on("error",function(e){}),delete i}}
window.addEventListener("cloudkitloaded",function(){function e(e){isSignin=!0,hideWelcome(),availability(),a()
try{currentUsername=e.userRecordName,clickToShowStatus(!0)}catch(e){currentUsername=""}n.whenUserSignsOut().then(i)}function i(a){isValid=!1,isSignin=!1,isFetching=!1,availability(),cleanupCopies(),showWelcome(),hideLoadingPanel(),a&&"AUTH_PERSIST_ERROR"===a.ckErrorCode&&alert(window.lang.translate("Unable to set a cookie, please check your browser settings for cookie and try again.")),n.whenUserSignsIn().then(e).catch(i),$("#apple-sign-in-button").find("svg").css("width","218px")}function a(){if(!isFetching&&!isUploading&&isSignin){isFetching=!0,showLoadingPanel()
var e={recordType:"Copy",sortBy:[{fieldName:"created",ascending:"False"}]}
isSearching?e.filterBy=[{comparator:"CONTAINS_ANY_TOKENS",fieldName:"content",fieldValue:{value:lastKeyword.toString()}}]:(0==lastCreated?lastCreated=now():invalidCreated>0&&lastCreated<invalidCreated&&(lastCreated=invalidCreated),e.filterBy=[{comparator:"LESS_THAN_OR_EQUALS",fieldName:"created",fieldValue:{value:lastCreated.toString()}}])
var i={resultsLimit:fetchLimits,numbersAsStrings:!0}
t.performQuery(e,i).then(function(e){if(!e.hasErrors)try{var i=e.records
appendCopies(i)
for(var a=0;a<i.length;a++){var n=parseInt(i[a].fields.created.value)
n<lastCreated&&(lastCreated=n)}delete i}catch(e){console.log(e)}hideLoadingPanel(),isFetching=!1,isValid||setTimeout(function(){invalidCreated=isValid?0:now()-maxLastCreated},panelConfirmTimeout)})}}CloudKit.configure({locale:"en-us",containers:[{containerIdentifier:"iCloud.com.lkmake.copies",apiTokenAuth:{apiToken:token,persist:!0,signInButton:{id:"apple-sign-in-button",theme:"black"},signOutButton:{id:"apple-sign-out-button",theme:"white_with_outline"}},environment:env}]})
var n=CloudKit.getDefaultContainer(),t=n.privateCloudDatabase
return previewCopy=function(e){UIkit.lightbox.create([{source:e,type:"image"}]).show()},removeCopy=function(e){if(!isValid)return void clickToShowStatus(!1)
var i=$("#"+e)
i&&UIkit.modal.confirm("<span lang='us'>Are you sure to delete?</span>",function(){var a=UIkit.modal.blockUI("<span lang='us'>Deleting copy now, please wait...</span>")
t.deleteRecords(e,{}).then(function(e){e.hasErrors||i.fadeOut().remove(),a.hide()}),setTimeout(function(){a.hide()},panelConfirmTimeout)})},saveCopy=function(e){isUploading=!0
var i=UIkit.modal.blockUI("<span lang='us'>Saving copy now, please wait...</span>"),a={numbersAsStrings:!0}
setTimeout(function(){i.hide(),isUploading=!1},uploadTimeout),t.saveRecords(e,a).then(function(e){isUploading=!1,i.hide(),e.hasErrors||setTimeout(function(){clickToRefresh()},saveAndRefreshTimeout)})},clickToRefresh=function(){isValid?(lastCreated=0,a()):clickToShowStatus(!1)},clickToAdd=function(){if(!isUploading)if(isValid){var e=UIkit.modal("#add-wrapper")
e.show()}else clickToShowStatus(!1)},clickToEndAdd=function(){UIkit.modal("#add-wrapper").hide()
try{var e,i=$("#add-text").val(),a=i.toString()
if(!(a.length>0))throw"Empty input, ignore."
var n=SparkMD5.hash(i)
e={recordName:n.toString(),recordType:"Copy",fields:{md5:{value:n.toString()},content:{value:i.toString()},created:{value:now().toString()},img:{value:"2"}}},saveCopy(e),delete e}catch(e){}$("#add-text").val("")},clickToSearch=function(){if(isValid){var e=UIkit.modal.prompt("<span lang='us'>Enter keyword to search:</span>","",function(e){""!=e&&(isSearching=!0,lastKeyword=e,removeCopies(),$("#search-keyword").html(e),$("#search-wrapper").fadeIn(),a())})
setTimeout(function(){e.hide()},panelConfirmTimeout)}else clickToShowStatus(!1)},clickToEndSearch=function(){isSearching=!1,lastCreated=0,lastKeyword="",$("#search-keyword").html(""),$("#search-wrapper").fadeOut(),removeCopies(),a()},clickToShowStatus=function(e){function i(i){if(hideLoadingPanel(),cleanupCopies(),showWelcome(),isPaused){var n=UIkit.modal.alert("<span lang='us'>Sync service is paused.<span>")
setTimeout(function(){n.hide()},panelConfirmTimeout)}if(!e){a.hide()
var n=UIkit.modal.alert(i)
setTimeout(function(){n.hide()},panelConfirmTimeout)}}if(""!=currentUsername){var a
e||(a=UIkit.modal.blockUI("<span lang='us'>Loading status info now, please wait...</span>"))
var n={recordType:"Sync",sortBy:[{fieldName:"created",ascending:"False"}]}
n.filterBy=[{comparator:"EQUALS",fieldName:"account",fieldValue:{value:currentUsername}}]
var o={numbersAsStrings:!0},r="<span lang='us'>Sync service status unknown, please try again later.</span>"
isValid=!1
try{t.performQuery(n,o).then(function(n){if(n.hasErrors)i(r)
else{var t=n.records
if(t.length>0){if("1"==t[0].fields.status.value){if(isValid=!0,isPaused=!1,r="<span lang='us'>Sync service is active.</span>",hideLoadingPanel(),e)return
a.hide()
var o=UIkit.modal.alert(r)
setTimeout(function(){o.hide()},panelConfirmTimeout)}else r="<span lang='us'>Sync service is paused.</span>",isPaused=!0,i(r)}else r="<span lang='us'>Sync service is inactive, please enable cloud sync on your Mac.</span>",i(r)
delete t}})}catch(e){i(r)}}},clickToLoadMore=function(){a()},n.setUpAuth().then(function(a){a?e(a):i()})}),$(window).on("orientationchange",function(){availability()}),$(window).scroll(function(){if(isSearching){var e=$("#search-wrapper")
$(window).scrollTop()>80?e.addClass("search-fixed"):e.removeClass("search-fixed")}}),$(document).ready(function(){$("#copies-load-more").hide(),$("#copies-action").hide(),$("#search-wrapper").hide()
var e=$("#add-image-thumbnail")
$("#add-image").change(function(i){setTimeout(function(){UIkit.modal("#add-wrapper").hide()},previewTimeout)
try{var a=i.target.files[0]
if(!a)throw"No image, ignore."
var n=new FileReader,t=new FileReader
n.readAsBinaryString(a),t.readAsDataURL(a),n.onloadend=function(i){var n=i.target.result,o=SparkMD5.hashBinary(n),r=a.name
if(a.size>imageSizeLimits)throw"Image too large, ignore."
t.onload=function(i){var n=document.createElement("canvas"),t=new Image
t.src=i.target.result,t.onload=function(){if(n.id="privateCanvas",n.width=Number(64),n.height=Number(64),n.getContext){var i=n.getContext("2d")
i.drawImage(t,0,0,n.width,n.height)
var s=n.toDataURL("image/png",.8)
if(null!=s&&void 0!=s){e.attr("src",s),e.fadeIn()
var l=null
try{l=dataURItoBlob(s)}catch(e){}saveCopy({recordName:o,recordType:"Copy",fields:{md5:{value:o},content:{value:r},created:{value:now().toString()},img:{value:"1"},r_img:{value:a},s_img:{value:l}}}),delete l}}}}}}catch(e){isUploading=!1}$("#add-image").val(""),e.val(""),e.hide()}),e.hide(),availability(),keyboardShortcuts(),setInterval(function(){!isValid||!isSignin||isFetching||isSearching||isUploading||clickToRefresh()},refreshTimeout)})
